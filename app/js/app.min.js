angular.module("app",["ngCookies"]);var libroApp=angular.module("libroApp",["ngRoute","ngCookies","ui.bootstrap","libroControllers","libroServices"]).config(["$locationProvider",function(c){c.html5Mode(!0)}]);
libroApp.config(["$routeProvider",function(c){c.when("/app/login",{templateUrl:"/app/partials/login.html",controller:"LoginCtrl"}).when("/app/logout",{templateUrl:"/app/partials/login.html",controller:"LogoutCtrl"}).when("/app/socios",{templateUrl:"/app/partials/socios.html",controller:"SociosCtrl"}).when("/app/socios/:socioId",{templateUrl:"/app/partials/socio.html",controller:"SocioCtrl"}).when("/app/socio/nuevo",{templateUrl:"/app/partials/nuevo.html",controller:"NuevoSocioCtrl"}).otherwise({redirectTo:"/app/socios"})}]);
"use strict";var libroControllers=angular.module("libroControllers",[]);libroControllers.controller("LoginCtrl",["$cookies","$scope","$location",function(c,b,a){c.username&&c.password?a.url("/"):b.logIn=function(){event.preventDefault();c.username=b.username;c.password=b.password;a.url("/")}}]);libroControllers.controller("LogoutCtrl",["$cookies","$scope","$location",function(c,b,a){c.username="";c.password="";a.url("/login")}]);
libroControllers.controller("SociosCtrl",["ApiCall","$modal","optiones","galletitas","$http","$scope","$location",function(c,b,a,e,f,d,g){if(e.isLogged()){var h=!0;d.actualizar=function(){d.loadSocios(d.options.currentPage)};d.reset=function(){d.options=a.reset();d.loadSocios(d.options.currentPage)};d.changePage=function(a){d.options.currentPage=a;d.loadSocios(d.options.currentPage)};d.loadSocios=function(a){h&&(h=!1,c.getSocios(a,e.getXWSSE(),d.options).then(function(a){200==a.status&&(d.socios=
a.data.socios,d.totalItems=a.data.pagination.totalResults,d.options.currentPage=parseInt(a.data.pagination.currentPage),d.currentPage=a.data.pagination.currentPage,d.maxResults=a.data.pagination.maxResults,h=!0)}))};d["delete"]=function(a){b.open({templateUrl:"/app/partials/modal/delete.html",controller:DeleteModalInstanceCtrl,resolve:{socio:function(){return a}}}).result.then(function(){d.loadSocios(d.options.currentPage)})};d.edit=function(a){console.log(a)};d.options=a.get();d.maxSize=100;d.isCollapsed=
!0;d.toCollapse=function(){d.isCollapsed=!d.isCollapsed};d.loadSocios(d.options.currentPage)}else g.url("/login")}]);
var DeleteModalInstanceCtrl=["ApiCall","galletitas","$scope","$modalInstance","socio",function(c,b,a,e,f){a.socio=f;a.alerts=[{type:"warning",msg:"\u00a1Esta acci\u00f3n no se puede deshacer!"}];a.addAlert=function(b,c){a.alerts.push({type:b,msg:c})};a.closeAlert=function(b){a.alerts.splice(b,1)};a.deletAlerts=function(){a.alerts=""};a.salir=function(){e.dismiss()};a.ok=function(d){d=="ELIMINAR "+a.socio.esncard?(a.addAlert("success","Nuestros monos lo est\u00e1n borrando... Espera y no toques nada."),
c.deleteSocio(b.getXWSSE(),a.socio.id).then(function(b){204==b.status&&e.close();401==b.status&&a.addAlert("danger","\u00a1Tu sesion ha caducado..!");403==b.status&&a.addAlert("danger","\u00a1No tienes permiso para borrar socios!")})):a.addAlert("danger","\u00a1Tienes que escribir la confirmaci\u00f3n correcta!")}}];
libroControllers.controller("SocioCtrl",["$routeParams","$cookies","$http","$scope","xwsse","$location",function(c,b,a,e,f,d){b.username&&b.password?(b=f.calc(b.username,b.password),a.defaults.headers.get={"X-WSSE":b},a({method:"GET",url:"/api/socios/"+c.socioId}).success(function(a){e.socio=a}).error(function(a,b){e.error={code:b,descripcion:""}})):d.url("/login")}]);
libroControllers.controller("NuevoSocioCtrl",["ApiCall","$modal","optiones","galletitas","$http","$scope","$location",function(c,b,a,e,f,d,g){e.isLogged()?(f.get("/app/resources/countries.json").success(function(a){d.countries=a.countries}),d.socio={created_at:(new Date).toJSON().slice(0,10)},d.registrar=function(){if(!this.nuevoSocio.$invalid){var a=this.socio;b.open({templateUrl:"/app/partials/modal/registrar.html",controller:RegistrarModalInstanceCtrl,resolve:{socio:function(){return a}}}).result.then(function(){d.nuevoSocio.$setPristine();
d.socio={nombre:"",apellido:"",esncard:"",created_at:(new Date).toJSON().slice(0,10),passport:"",pais:"",email:""}})}}):g.url("/login")}]);
var RegistrarModalInstanceCtrl=["ApiCall","galletitas","$scope","$modalInstance","socio",function(c,b,a,e,f){a.successFlag=!1;a.failFlag=!1;a.progress="50";a.status="progress-bar-warning";a.isCollapsed=!1;c.postSocio(f,b.getXWSSE()).then(function(b){a.successFlag=!0;a.progress="100";a.status="progress-bar-success"},function(b){a.failFlag=!0;a.progress="100";a.status="progress-bar-danger";a.errors=b.data});a.volver=function(){e.close()};a.salir=function(){e.dismiss()}}];"use strict";
var libroServices=angular.module("libroServices",["ngResource"]);libroServices.service("optiones",function(){this.config={orderBy:"created_at",orderDir:"DESC",currentPage:1,maxResults:25};this.get=function(){return this.config};this.getValue=function(c){return this.config[c]};this.set=function(c){this.config=c;return this};this.reset=function(){return{orderBy:"created_at",orderDir:"DESC",currentPage:1,maxResults:25}}});"use strict";
libroApp.factory("ApiCall",["$http",function(c){return{getSocios:function(b,a,e){c.defaults.headers.get={"X-WSSE":a,"Current-Page":b,"Max-Results":10,"Query-Options":angular.toJson(e)};return c({method:"GET",url:"/api/socios"}).then(function(a){return a})},postSocio:function(b,a){c.defaults.headers.post={"X-WSSE":a};return c({method:"POST",url:"/api/socios",data:b}).then(function(a){return a})},deleteSocio:function(b,a){c.defaults.headers["delete"]={"X-WSSE":b};return c({method:"DELETE",url:"/api/socios/"+
a}).then(function(a){return a})}}}]);libroServices.service("galletitas",["$cookies","xwsse",function(c,b){this.isLogged=function(){return c.username&&c.password?!0:!1};this.get=function(a){return c[a]};this.getXWSSE=function(){return b.calc(c.username,c.password)}}]);
libroServices.service("base64",function(){this.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";this.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,
48,49,50,51,-1,-1,-1,-1,-1];this.base64encode=function(c){var b,a,e,f,d,g;e=c.length;a=0;for(b="";a<e;){f=c.charCodeAt(a++)&255;if(a==e){b+=this.base64EncodeChars.charAt(f>>2);b+=this.base64EncodeChars.charAt((f&3)<<4);b+="==";break}d=c.charCodeAt(a++);if(a==e){b+=this.base64EncodeChars.charAt(f>>2);b+=this.base64EncodeChars.charAt((f&3)<<4|(d&240)>>4);b+=this.base64EncodeChars.charAt((d&15)<<2);b+="=";break}g=c.charCodeAt(a++);b+=this.base64EncodeChars.charAt(f>>2);b+=this.base64EncodeChars.charAt((f&
3)<<4|(d&240)>>4);b+=this.base64EncodeChars.charAt((d&15)<<2|(g&192)>>6);b+=this.base64EncodeChars.charAt(g&63)}return b};this.base64decode=function(c){var b,a,e,f,d;f=c.length;e=0;for(d="";e<f;){do b=this.base64DecodeChars[c.charCodeAt(e++)&255];while(e<f&&-1==b);if(-1==b)break;do a=this.base64DecodeChars[c.charCodeAt(e++)&255];while(e<f&&-1==a);if(-1==a)break;d+=String.fromCharCode(b<<2|(a&48)>>4);do{b=c.charCodeAt(e++)&255;if(61==b)return d;b=this.base64DecodeChars[b]}while(e<f&&-1==b);if(-1==
b)break;d+=String.fromCharCode((a&15)<<4|(b&60)>>2);do{a=c.charCodeAt(e++)&255;if(61==a)return d;a=this.base64DecodeChars[a]}while(e<f&&-1==a);if(-1==a)break;d+=String.fromCharCode((b&3)<<6|a)}return d}});
libroServices.service("sha1",function(){this.hexcase=0;this.b64pad="=";this.chrsz=8;this.hex_sha1=function(c){return this.binb2hex(this.core_sha1(this.str2binb(c),c.length*this.chrsz))};this.b64_sha1=function(c){return this.binb2b64(this.core_sha1(this.str2binb(c),c.length*this.chrsz))};this.str_sha1=function(c){return this.binb2str(this.core_sha1(this.str2binb(c),c.length*this.chrsz))};this.hex_hmac_sha1=function(c,b){return this.binb2hex(this.core_hmac_sha1(c,b))};this.b64_hmac_sha1=function(c,
b){return this.binb2b64(this.core_hmac_sha1(c,b))};this.str_hmac_sha1=function(c,b){return this.binb2str(this.core_hmac_sha1(c,b))};this.sha1_vm_test=function(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==this.hex_sha1("abc")};this.core_sha1=function(c,b){c[b>>5]|=128<<24-b%32;c[(b+64>>9<<4)+15]=b;for(var a=Array(80),e=1732584193,f=-271733879,d=-1732584194,g=271733878,h=-1009589776,l=0;l<c.length;l+=16){for(var m=e,n=f,p=d,q=g,r=h,k=0;80>k;k++){a[k]=16>k?c[l+k]:this.rol(a[k-3]^a[k-8]^a[k-14]^
a[k-16],1);var s=this.safe_add(this.safe_add(this.rol(e,5),this.sha1_ft(k,f,d,g)),this.safe_add(this.safe_add(h,a[k]),this.sha1_kt(k))),h=g,g=d,d=this.rol(f,30),f=e,e=s}e=this.safe_add(e,m);f=this.safe_add(f,n);d=this.safe_add(d,p);g=this.safe_add(g,q);h=this.safe_add(h,r)}return[e,f,d,g,h]};this.sha1_ft=function(c,b,a,e){return 20>c?b&a|~b&e:40>c?b^a^e:60>c?b&a|b&e|a&e:b^a^e};this.sha1_kt=function(c){return 20>c?1518500249:40>c?1859775393:60>c?-1894007588:-899497514};this.core_hmac_sha1=function(c,
b){var a=this.str2binb(c);16<a.length&&(a=this.core_sha1(a,c.length*this.chrsz));for(var e=Array(16),f=Array(16),d=0;16>d;d++)e[d]=a[d]^909522486,f[d]=a[d]^1549556828;a=this.core_sha1(e.concat(this.str2binb(b)),512+b.length*this.chrsz);return this.core_sha1(f.concat(a),672)};this.safe_add=function(c,b){var a=(c&65535)+(b&65535);return(c>>16)+(b>>16)+(a>>16)<<16|a&65535};this.rol=function(c,b){return c<<b|c>>>32-b};this.str2binb=function(c){for(var b=[],a=(1<<this.chrsz)-1,e=0;e<c.length*this.chrsz;e+=
this.chrsz)b[e>>5]|=(c.charCodeAt(e/this.chrsz)&a)<<24-e%32;return b};this.binb2str=function(c){for(var b="",a=(1<<this.chrsz)-1,e=0;e<32*c.length;e+=this.chrsz)b+=String.fromCharCode(c[e>>5]>>>24-e%32&a);return b};this.binb2hex=function(c){for(var b=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",a="",e=0;e<4*c.length;e++)a+=b.charAt(c[e>>2]>>8*(3-e%4)+4&15)+b.charAt(c[e>>2]>>8*(3-e%4)&15);return a};this.binb2b64=function(c){for(var b="",a=0;a<4*c.length;a+=3)for(var e=(c[a>>2]>>8*(3-a%4)&255)<<
16|(c[a+1>>2]>>8*(3-(a+1)%4)&255)<<8|c[a+2>>2]>>8*(3-(a+2)%4)&255,f=0;4>f;f++)b=8*a+6*f>32*c.length?b+this.b64pad:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-f)&63);return b}});
libroServices.service("xwsse",["base64","sha1",function(c,b){this.b64pad="=";this.calc=function(a,e){var f=this.generateNonce(16),d=c.base64encode(f),g=this.getW3CDate(new Date),f=b.b64_sha1(f+g+e);return'UsernameToken Username="'+a+'", PasswordDigest="'+f+'", Nonce="'+d+'", Created="'+g+'"'};this.generateNonce=function(a){for(var b="",c=0;c<a;c++)b+="0123456789abcdef".charAt(Math.floor(16*Math.random()));return b};this.getW3CDate=function(a){var b=a.getUTCFullYear(),c=a.getUTCMonth()+1;10>c&&(c=
"0"+c);var d=a.getUTCDate();10>d&&(d="0"+d);var g=a.getUTCHours();10>g&&(g="0"+g);var h=a.getUTCMinutes();10>h&&(h="0"+h);a=a.getUTCSeconds();10>a&&(a="0"+a);return b+"-"+c+"-"+d+"T"+g+":"+h+":"+a+"Z"}}]);libroServices.factory("Socio",["$resource",function(c){return c("/apisocios",{},{query:{method:"GET",interceptor:{response:function(b){console.log("response in interceptor",b)},responseError:function(b){console.log("error in interceptor",b)}},isArray:!0}})}]);